(()=>{var t={973:t=>{for(var e=[],n=0;n<256;++n)e[n]=(n+256).toString(16).substr(1);t.exports=function(t,n){var r=n||0,o=e;return[o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],"-",o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]],o[t[r++]]].join("")}},963:t=>{var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var n=new Uint8Array(16);t.exports=function(){return e(n),n}}else{var r=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),r[e]=t>>>((3&e)<<3)&255;return r}}},998:(t,e,n)=>{var r,o,s=n(963),i=n(973),a=0,c=0;t.exports=function(t,e,n){var h=e&&n||0,u=e||[],l=(t=t||{}).node||r,d=void 0!==t.clockseq?t.clockseq:o;if(null==l||null==d){var f=s();null==l&&(l=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=o=16383&(f[6]<<8|f[7]))}var g=void 0!==t.msecs?t.msecs:(new Date).getTime(),p=void 0!==t.nsecs?t.nsecs:c+1,m=g-a+(p-c)/1e4;if(m<0&&void 0===t.clockseq&&(d=d+1&16383),(m<0||g>a)&&void 0===t.nsecs&&(p=0),p>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,c=p,o=d;var y=(1e4*(268435455&(g+=122192928e5))+p)%4294967296;u[h++]=y>>>24&255,u[h++]=y>>>16&255,u[h++]=y>>>8&255,u[h++]=255&y;var w=g/4294967296*1e4&268435455;u[h++]=w>>>8&255,u[h++]=255&w,u[h++]=w>>>24&15|16,u[h++]=w>>>16&255,u[h++]=d>>>8|128,u[h++]=255&d;for(var v=0;v<6;++v)u[h+v]=l[v];return e||i(u)}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=class{constructor(t,e){this.digit=t,this.siteId=e}compareTo(t){return this.digit<t.digit?-1:this.digit>t.digit?1:this.siteId<t.siteId?-1:this.siteId>t.siteId?1:0}},e=class{constructor(t,e=32,n=10,r="random",o=2){this.controller=t,this.vector=t.vector,this.struct=[],this.siteId=t.siteId,this.text="",this.base=e,this.boundary=n,this.strategy=r,this.strategyCache=[],this.mult=o}handleLocalInsert(t,e){this.vector.increment();const n=this.generateChar(t,e);this.insertChar(e,n),this.insertText(n.value,e),this.controller.broadcastInsertion(n)}handleRemoteInsert(t){const e=this.findInsertIndex(t);this.insertChar(e,t),this.insertText(t.value,e),this.controller.insertIntoEditor(t.value,e,t.siteId)}insertChar(t,e){this.struct.splice(t,0,e)}handleLocalDelete(t){this.vector.increment();const e=this.struct.splice(t,1)[0];this.deleteText(t),this.controller.broadcastDeletion(e)}handleRemoteDelete(t,e){const n=this.findIndexByPosition(t);this.struct.splice(n,1),this.controller.deleteFromEditor(t.value,n,e),this.deleteText(n)}findInsertIndex(t){let e,n,r=0,o=this.struct.length-1;if(0===this.struct.length||t.compareTo(this.struct[r])<0)return r;if(t.compareTo(this.struct[o])>0)return this.struct.length;for(;r+1<o;){if(e=Math.floor(r+(o-r)/2),n=t.compareTo(this.struct[e]),0===n)return e;n>0?r=e:o=e}return 0===t.compareTo(this.struct[r])?r:o}findIndexByPosition(t){let e,n,r=0,o=this.struct.length-1;if(0===this.struct.length)throw new Error("Character does not exist in CRDT.");for(;r+1<o;){if(e=Math.floor(r+(o-r)/2),n=t.compareTo(this.struct[e]),0===n)return e;n>0?r=e:o=e}if(0===t.compareTo(this.struct[r]))return r;if(0===t.compareTo(this.struct[o]))return o;throw new Error("Character does not exist in CRDT.")}generateChar(t,e){const n=this.struct[e-1]&&this.struct[e-1].position||[],r=this.struct[e]&&this.struct[e].position||[],o=this.generatePosBetween(n,r),s=this.vector.localVersion.counter;return new class{constructor(t,e,n,r){this.position=r,this.counter=e,this.siteId=n,this.value=t}compareTo(t){let e,n,r;const o=this.position,s=t.position;for(let t=0;t<Math.min(o.length,s.length);t++)if(n=o[t],r=s[t],e=n.compareTo(r),0!==e)return e;return o.length<s.length?-1:o.length>s.length?1:0}}(t,s,this.siteId,o)}retrieveStrategy(t){if(this.strategyCache[t])return this.strategyCache[t];let e;switch(this.strategy){case"plus":e="+";break;case"minus":e="-";break;case"random":e=0===Math.round(Math.random())?"+":"-";break;case"every2nd":default:e=(t+1)%2==0?"-":"+";break;case"every3rd":e=(t+1)%3==0?"-":"+"}return this.strategyCache[t]=e,e}generatePosBetween(e,n,r=[],o=0){let s=Math.pow(this.mult,o)*this.base,i=this.retrieveStrategy(o),a=e[0]||new t(0,this.siteId),c=n[0]||new t(s,this.siteId);if(c.digit-a.digit>1){let e=this.generateIdBetween(a.digit,c.digit,i);return r.push(new t(e,this.siteId)),r}if(c.digit-a.digit==1)return r.push(a),this.generatePosBetween(e.slice(1),[],r,o+1);if(a.digit===c.digit){if(a.siteId<c.siteId)return r.push(a),this.generatePosBetween(e.slice(1),[],r,o+1);if(a.siteId===c.siteId)return r.push(a),this.generatePosBetween(e.slice(1),n.slice(1),r,o+1);throw new Error("Fix Position Sorting")}}generateIdBetween(t,e,n){return e-t<this.boundary?t+=1:"-"===n?t=e-this.boundary:e=(t+=1)+this.boundary,Math.floor(Math.random()*(e-t))+t}insertText(t,e){this.text=this.text.slice(0,e)+t+this.text.slice(e)}deleteText(t){this.text=this.text.slice(0,t)+this.text.slice(t+1)}populateText(){this.text=this.struct.map((t=>t.value)).join("")}};var r=n(998),o=n.n(r);function s(t,e){const n=Date.now();let r;for(let n=0;n<e;n++)r=Math.floor(Math.random()*n),t.handleLocalInsert("a",r);return Date.now()-n}function i(t,e){return a(t,l(u(e)))}function a(t,e){const n=Date.now();return e.forEach((e=>t.handleRemoteInsert(e))),Date.now()-n}function c(t){const e=Date.now();for(let e=t.struct.length-1;e>=0;e--)t.handleLocalDelete(e);return Date.now()-e}function h(t,e){const n=Date.now();return e.forEach((e=>t.handleRemoteDelete(e))),Date.now()-n}function u(t){const n=function(t){const n=function(t){let n,r=[];for(let s=0;s<t;s++)n=new e({siteId:o()(),broadcastInsertion:function(){},broadcastDeletion:function(){},insertIntoEditor:function(){},deleteFromEditor:function(){},vector:{localVersion:{counter:0},increment:function(){this.localVersion.counter++}}}),r.push(n);return r}(Math.log10(t)),r=t/n.length;return n.forEach((t=>s(t,r))),n.map((t=>t.struct))}(t),r=[];for(let t=0;t<n[0].length;t++)n.forEach((e=>r.push(e[t])));return r}function l(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function d(){return{siteId:o()(),broadcastInsertion:function(){},broadcastDeletion:function(){},insertIntoEditor:function(){},deleteFromEditor:function(){},vector:{localVersion:{counter:0},increment:function(){this.localVersion.counter++}}}}let f,g,p,m,y,w,v;const x=[32,2064],I=[10,100],b=[1e3,5e3,1e4,2e4];f=[[s,"random"],[function(t,e){const n=Date.now();for(let n=0;n<e;n++)t.handleLocalInsert("a",n);return Date.now()-n},"at end"],[function(t,e){const n=Date.now();for(let n=0;n<e;n++)t.handleLocalInsert("a",0);return Date.now()-n},"at beginning"]],y=[],f.forEach((t=>{x.forEach((n=>{I.forEach((r=>{p=[],m=[],g=new e(d(),n,r,"random",2),g.insertText=function(){},g.deleteText=function(){},b.forEach((e=>{p.push(e),m.push(t[0](g,e)),g.struct=[]})),w=`base: ${n}, boundary: ${r}, ${t[1]}`,y.push({x:p,y:m,type:"scatter",name:w})}))}))})),v="Local Insertions, Different Bases and Boundaries (mult = 2, strategy = random)",Plotly.newPlot("g0",y,{title:v,height:600}),f=[[function(t){const e=Date.now();let n;for(let e=t.struct.length-1;e>=0;e--)n=Math.floor(Math.random()*e),t.handleLocalDelete(n);return Date.now()-e},"random"],[c,"at end"],[c,"at beginning"]],y=[],f.forEach((t=>{x.forEach((n=>{I.forEach((r=>{p=[],m=[],g=new e(d(),n,r,"random",2),g.insertText=function(){},g.deleteText=function(){},b.forEach((e=>{p.push(e),s(g,e),m.push(t[0](g,e)),g.struct=[]})),w=`base: ${n}, boundary: ${r}, ${t[1]}`,y.push({x:p,y:m,type:"scatter",name:w})}))}))})),v="Local Deletions, Different Bases and Boundaries (mult = 2, strategy = random)",Plotly.newPlot("g1",y,{title:v,height:600}),f=[[i,"random"],[function(t,e){return a(t,u(e))},"at end"],[function(t,e){return a(t,u(e).reverse())},"at beginning"]],y=[],f.forEach((t=>{x.forEach((n=>{I.forEach((r=>{p=[],m=[],g=new e(d(),n,r,"random",2),g.insertText=function(){},g.deleteText=function(){},b.forEach((e=>{p.push(e),m.push(t[0](g,e)),g.struct=[]})),w=`base: ${n}, boundary: ${r}, ${t[1]}`,y.push({x:p,y:m,type:"scatter",name:w})}))}))})),v="Remote Insertions, Different Bases and Boundaries (mult = 2, strategy = random)",Plotly.newPlot("g2",y,{title:v,height:600}),f=[[function(t){let e=[];return t.struct.forEach((t=>e.push(t))),h(t,l(e))},"random"],[function(t){let e=[];return t.struct.forEach((t=>e.push(t))),h(t,e.reverse())},"at end"],[function(t){let e=[];return t.struct.forEach((t=>e.push(t))),h(t,e)},"at beginning"]],y=[],f.forEach((t=>{x.forEach((n=>{I.forEach((r=>{p=[],m=[],b.forEach((o=>{g=new e(d(),n,r,"random",2),g.insertText=function(){},g.deleteText=function(){},i(g,o),p.push(o),m.push(t[0](g,o))})),w=`base: ${n}, boundary: ${r}, ${t[1]}`,y.push({x:p,y:m,type:"scatter",name:w})}))}))})),v="Remote Deletions, Different Bases and Boundaries (mult = 2, strategy = random)",Plotly.newPlot("g3",y,{title:v,height:600})})()})();