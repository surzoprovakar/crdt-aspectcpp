(()=>{var t={973:t=>{for(var e=[],r=0;r<256;++r)e[r]=(r+256).toString(16).substr(1);t.exports=function(t,r){var n=r||0,s=e;return[s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],"-",s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]],s[t[n++]]].join("")}},963:t=>{var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var r=new Uint8Array(16);t.exports=function(){return e(r),r}}else{var n=new Array(16);t.exports=function(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),n[e]=t>>>((3&e)<<3)&255;return n}}},998:(t,e,r)=>{var n,s,i=r(963),o=r(973),h=0,c=0;t.exports=function(t,e,r){var a=e&&r||0,l=e||[],u=(t=t||{}).node||n,d=void 0!==t.clockseq?t.clockseq:s;if(null==u||null==d){var f=i();null==u&&(u=n=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=s=16383&(f[6]<<8|f[7]))}var p=void 0!==t.msecs?t.msecs:(new Date).getTime(),g=void 0!==t.nsecs?t.nsecs:c+1,m=p-h+(g-c)/1e4;if(m<0&&void 0===t.clockseq&&(d=d+1&16383),(m<0||p>h)&&void 0===t.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=p,c=g,s=d;var I=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;l[a++]=I>>>24&255,l[a++]=I>>>16&255,l[a++]=I>>>8&255,l[a++]=255&I;var y=p/4294967296*1e4&268435455;l[a++]=y>>>8&255,l[a++]=255&y,l[a++]=y>>>24&15|16,l[a++]=y>>>16&255,l[a++]=d>>>8|128,l[a++]=255&d;for(var w=0;w<6;++w)l[a+w]=u[w];return e||o(l)}}},e={};function r(n){var s=e[n];if(void 0!==s)return s.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=class{constructor(t,e){this.digit=t,this.siteId=e}compareTo(t){return this.digit<t.digit?-1:this.digit>t.digit?1:this.siteId<t.siteId?-1:this.siteId>t.siteId?1:0}},e=class{constructor(t,e,r,n){this.position=n,this.counter=e,this.siteId=r,this.value=t}compareTo(t){let e,r,n;const s=this.position,i=t.position;for(let t=0;t<Math.min(s.length,i.length);t++)if(r=s[t],n=i[t],e=r.compareTo(n),0!==e)return e;return s.length<i.length?-1:s.length>i.length?1:0}},n=class{constructor(t,e=32,r=10,n="random",s=2){this.controller=t,this.vector=t.vector,this.struct=[],this.siteId=t.siteId,this.text="",this.base=e,this.boundary=r,this.strategy=n,this.strategyCache=[],this.mult=s}handleLocalInsert(t,e){this.vector.increment();const r=this.generateChar(t,e);this.insertChar(e,r),this.insertText(r.value,e),this.controller.broadcastInsertion(r)}handleRemoteInsert(t){const e=this.findInsertIndex(t);this.insertChar(e,t),this.insertText(t.value,e),this.controller.insertIntoEditor(t.value,e,t.siteId)}insertChar(t,e){this.struct.splice(t,0,e)}handleLocalDelete(t){this.vector.increment();const e=this.struct.splice(t,1)[0];this.deleteText(t),this.controller.broadcastDeletion(e)}handleRemoteDelete(t,e){const r=this.findIndexByPosition(t);this.struct.splice(r,1),this.controller.deleteFromEditor(t.value,r,e),this.deleteText(r)}findInsertIndex(t){let e,r,n=0,s=this.struct.length-1;if(0===this.struct.length||t.compareTo(this.struct[n])<0)return n;if(t.compareTo(this.struct[s])>0)return this.struct.length;for(;n+1<s;){if(e=Math.floor(n+(s-n)/2),r=t.compareTo(this.struct[e]),0===r)return e;r>0?n=e:s=e}return 0===t.compareTo(this.struct[n])?n:s}findIndexByPosition(t){let e,r,n=0,s=this.struct.length-1;if(0===this.struct.length)throw new Error("Character does not exist in CRDT.");for(;n+1<s;){if(e=Math.floor(n+(s-n)/2),r=t.compareTo(this.struct[e]),0===r)return e;r>0?n=e:s=e}if(0===t.compareTo(this.struct[n]))return n;if(0===t.compareTo(this.struct[s]))return s;throw new Error("Character does not exist in CRDT.")}generateChar(t,r){const n=this.struct[r-1]&&this.struct[r-1].position||[],s=this.struct[r]&&this.struct[r].position||[],i=this.generatePosBetween(n,s),o=this.vector.localVersion.counter;return new e(t,o,this.siteId,i)}retrieveStrategy(t){if(this.strategyCache[t])return this.strategyCache[t];let e;switch(this.strategy){case"plus":e="+";break;case"minus":e="-";break;case"random":e=0===Math.round(Math.random())?"+":"-";break;case"every2nd":default:e=(t+1)%2==0?"-":"+";break;case"every3rd":e=(t+1)%3==0?"-":"+"}return this.strategyCache[t]=e,e}generatePosBetween(e,r,n=[],s=0){let i=Math.pow(this.mult,s)*this.base,o=this.retrieveStrategy(s),h=e[0]||new t(0,this.siteId),c=r[0]||new t(i,this.siteId);if(c.digit-h.digit>1){let e=this.generateIdBetween(h.digit,c.digit,o);return n.push(new t(e,this.siteId)),n}if(c.digit-h.digit==1)return n.push(h),this.generatePosBetween(e.slice(1),[],n,s+1);if(h.digit===c.digit){if(h.siteId<c.siteId)return n.push(h),this.generatePosBetween(e.slice(1),[],n,s+1);if(h.siteId===c.siteId)return n.push(h),this.generatePosBetween(e.slice(1),r.slice(1),n,s+1);throw new Error("Fix Position Sorting")}}generateIdBetween(t,e,r){return e-t<this.boundary?t+=1:"-"===r?t=e-this.boundary:e=(t+=1)+this.boundary,Math.floor(Math.random()*(e-t))+t}insertText(t,e){this.text=this.text.slice(0,e)+t+this.text.slice(e)}deleteText(t){this.text=this.text.slice(0,t)+this.text.slice(t+1)}populateText(){this.text=this.struct.map((t=>t.value)).join("")}};var s=r(998),i=r.n(s);function o(t,e){const r=Date.now();return e.forEach((e=>t.handleRemoteInsert(e))),Date.now()-r}function h(t){const e=function(t){const e=function(t){let e,r=[];for(let s=0;s<t;s++)e=new n({siteId:i()(),broadcastInsertion:function(){},broadcastDeletion:function(){},insertIntoEditor:function(){},deleteFromEditor:function(){},vector:{localVersion:{counter:0},increment:function(){this.localVersion.counter++}}}),r.push(e);return r}(Math.log10(t)),r=t/e.length;return e.forEach((t=>function(t,e){const r=Date.now();let n;for(let r=0;r<e;r++)n=Math.floor(Math.random()*r),t.handleLocalInsert("a",n);return Date.now()-r}(t,r))),e.map((t=>t.struct))}(t),r=[];for(let t=0;t<e[0].length;t++)e.forEach((e=>r.push(e[t])));return r}const c=class{constructor(t,e=32,r=10,n="random"){this.controller=t,this.vector=t.vector,this.struct=[[]],this.siteId=t.siteId,this.base=e,this.boundary=r,this.strategy=n,this.strategyCache=[]}handleLocalInsert(t,e){this.vector.increment();const r=this.generateChar(t,e);this.insertChar(r,e),this.controller.broadcastInsertion(r)}handleRemoteInsert(t){const e=this.findInsertPosition(t);this.insertChar(t,e),this.controller.insertIntoEditor(t.value,e,t.siteId)}insertChar(t,e){if(e.line===this.struct.length&&this.struct.push([]),"\n"===t.value){const r=this.struct[e.line].splice(e.ch);if(0===r.length)this.struct[e.line].splice(e.ch,0,t);else{const n=this.struct[e.line].concat(t);this.struct.splice(e.line,1,n,r)}}else this.struct[e.line].splice(e.ch,0,t)}handleLocalDelete(t,e){let r,n=!1;t.line!==e.line?(n=!0,r=this.deleteMultipleLines(t,e)):(r=this.deleteSingleLine(t,e),r.find((t=>"\n"===t.value))&&(n=!0)),this.broadcast(r),this.removeEmptyLines(),n&&this.struct[t.line+1]&&this.mergeLines(t.line)}broadcast(t){t.forEach((t=>{this.vector.increment(),this.controller.broadcastDeletion(t,this.vector.getLocalVersion())}))}deleteMultipleLines(t,e){let r,n=this.struct[t.line].splice(t.ch);for(r=t.line+1;r<e.line;r++)n=n.concat(this.struct[r].splice(0));return this.struct[e.line]&&(n=n.concat(this.struct[e.line].splice(0,e.ch))),n}deleteSingleLine(t,e){let r=e.ch-t.ch;return this.struct[t.line].splice(t.ch,r)}mergeLines(t){const e=this.struct[t].concat(this.struct[t+1]);this.struct.splice(t,2,e)}removeEmptyLines(){for(let t=0;t<this.struct.length;t++)0===this.struct[t].length&&(this.struct.splice(t,1),t--);0===this.struct.length&&this.struct.push([])}handleRemoteDelete(t,e){const r=this.findPosition(t);r&&(this.struct[r.line].splice(r.ch,1),"\n"===t.value&&this.struct[r.line+1]&&this.mergeLines(r.line),this.removeEmptyLines(),this.controller.deleteFromEditor(t.value,r,e))}isEmpty(){return 1===this.struct.length&&0===this.struct[0].length}findPosition(t){let e,r,n,s,i,o,h,c,a=0,l=this.struct.length-1,u=this.struct[l];if(this.isEmpty()||t.compareTo(this.struct[0][0])<0)return!1;if(i=u[u.length-1],t.compareTo(i)>0)return!1;for(;a+1<l;){if(r=Math.floor(a+(l-a)/2),e=this.struct[r],i=e[e.length-1],0===t.compareTo(i))return{line:r,ch:e.length-1};t.compareTo(i)<0?l=r:a=r}return s=this.struct[a],h=s[s.length-1],o=this.struct[l],c=o[o.length-1],t.compareTo(h)<=0?(n=this.findIndexInLine(t,s),{line:a,ch:n}):(n=this.findIndexInLine(t,o),{line:l,ch:n})}findIndexInLine(t,e){let r,n,s=0,i=e.length-1;if(0===e.length||t.compareTo(e[s])<0)return s;if(t.compareTo(e[i])>0)return this.struct.length;for(;s+1<i;){if(r=Math.floor(s+(i-s)/2),n=t.compareTo(e[r]),0===n)return r;n>0?s=r:i=r}return 0===t.compareTo(e[s])?s:0===t.compareTo(e[i])&&i}findInsertPosition(t){let e,r,n,s,i,o,h,c,a=0,l=this.struct.length,u=l-1,d=this.struct[u];if(this.isEmpty()||t.compareTo(this.struct[0][0])<=0)return{line:0,ch:0};if(i=d[d.length-1],t.compareTo(i)>0)return this.findEndPosition(i,d,l);for(;a+1<u;){if(r=Math.floor(a+(u-a)/2),e=this.struct[r],i=e[e.length-1],0===t.compareTo(i))return{line:r,ch:e.length-1};t.compareTo(i)<0?u=r:a=r}return s=this.struct[a],h=s[s.length-1],o=this.struct[u],c=o[o.length-1],t.compareTo(h)<=0?(n=this.findInsertIndexInLine(t,s),{line:a,ch:n}):(n=this.findInsertIndexInLine(t,o),{line:u,ch:n})}findEndPosition(t,e,r){return"\n"===t.value?{line:r,ch:0}:{line:r-1,ch:e.length}}findInsertIndexInLine(t,e){let r,n,s=0,i=e.length-1;if(0===e.length||t.compareTo(e[s])<0)return s;if(t.compareTo(e[i])>0)return this.struct.length;for(;s+1<i;){if(r=Math.floor(s+(i-s)/2),n=t.compareTo(e[r]),0===n)return r;n>0?s=r:i=r}return 0===t.compareTo(e[s])?s:i}findPosBefore(t){let e=t.ch,r=t.line;return 0===e&&0===r?[]:(0===e&&0!==r&&(r-=1,e=this.struct[r].length),this.struct[r][e-1].position)}findPosAfter(t){let e=t.ch,r=t.line,n=this.struct.length,s=this.struct[r]&&this.struct[r].length||0;if(r===n-1&&e===s)return[];if(r<n-1&&e===s)r+=1,e=0;else if(r>n-1&&0===e)return[];return this.struct[r][e].position}generateChar(t,r){const n=this.findPosBefore(r),s=this.findPosAfter(r),i=this.generatePosBetween(n,s);return new e(t,this.vector.localVersion.counter,this.siteId,i)}retrieveStrategy(t){if(this.strategyCache[t])return this.strategyCache[t];let e;switch(this.strategy){case"plus":e="+";case"minus":e="-";case"random":e=0===Math.round(Math.random())?"+":"-";default:e=t%2==0?"+":"-"}return this.strategyCache[t]=e,e}generatePosBetween(e,r,n=[],s=0){let i=Math.pow(2,s)*this.base,o=this.retrieveStrategy(s),h=e[0]||new t(0,this.siteId),c=r[0]||new t(i,this.siteId);if(c.digit-h.digit>1){let e=this.generateIdBetween(h.digit,c.digit,o);return n.push(new t(e,this.siteId)),n}if(c.digit-h.digit==1)return n.push(h),this.generatePosBetween(e.slice(1),[],n,s+1);if(h.digit===c.digit){if(h.siteId<c.siteId)return n.push(h),this.generatePosBetween(e.slice(1),[],n,s+1);if(h.siteId===c.siteId)return n.push(h),this.generatePosBetween(e.slice(1),r.slice(1),n,s+1);throw new Error("Fix Position Sorting")}}generateIdBetween(t,e,r){return e-t<this.boundary?t+=1:"-"===r?t=e-this.boundary:e=(t+=1)+this.boundary,Math.floor(Math.random()*(e-t))+t}totalChars(){return this.struct.map((t=>t.length)).reduce(((t,e)=>t+e))}toText(){return this.struct.map((t=>t.map((t=>t.value)).join(""))).join("")}};function a(t,e){let r,n,s=0,i=0;const o=Date.now();for(let o=0;o<e;o++)100===s?(n={line:i,ch:s},t.handleLocalInsert("\n",n),i++,s=0):(r=Math.floor(Math.random()*s),n={line:i,ch:r},t.handleLocalInsert("a",n),s++);return Date.now()-o}function l(t,e){let r,n=0,s=0;const i=Date.now();for(let i=0;i<e;i++)100===n?(r={line:s,ch:n},t.handleLocalInsert("\n",r),s++,n=0):(r={line:s,ch:0},t.handleLocalInsert("a",r),n++);return Date.now()-i}function u(t){const e=t.totalChars(),r=Date.now();for(let r=e;r>0;r--){let e={line:0,ch:0},r={line:0,ch:1};t.handleLocalDelete(e,r)}return Date.now()-r}function d(){return{siteId:i()(),broadcastInsertion:function(){},broadcastDeletion:function(){},insertIntoEditor:function(){},deleteFromEditor:function(){},vector:{getLocalVersion:()=>{},localVersion:{counter:0},increment:function(){this.localVersion.counter++}}}}let f,p,g,m,I,y,w,v,x,T,L;const E=[1e3,1e4,2e4,4e4,6e4,8e4,1e5];p=32,g=10,m=2,I="random",L="Local Insertions",x=[],f=function(t,e){const r=Date.now();for(let r=0;r<e;r++)t.handleLocalInsert("a",0);return Date.now()-r},w=[],v=[],y=new n(d(),p,g,I,2),y.insertText=function(){},y.deleteText=function(){},E.forEach((t=>{w.push(t),v.push(f(y,t)),y.struct=[]})),T="Linear",x.push({x:w,y:v,type:"scatter",name:T}),f=l,w=[],v=[],y=new c(d(),p,g,I,2),E.forEach((t=>{w.push(t),v.push(f(y,t)),y.struct=[]})),T="Array-of-Arrays",x.push({x:w,y:v,type:"scatter",name:T}),Plotly.newPlot("g0",x,{title:L,height:600}),L="Local Deletions",x=[],f=function(t){const e=Date.now();for(let e=t.struct.length-1;e>=0;e--)t.handleLocalDelete(0);return Date.now()-e},w=[],v=[],y=new n(d(),p,g,I,2),y.insertText=function(){},y.deleteText=function(){},E.forEach((t=>{w.push(t),function(t,e){Date.now();for(let r=0;r<e;r++)t.handleLocalInsert("a",r);Date.now()}(y,t),v.push(f(y,t)),y.struct=[]})),T="Linear",x.push({x:w,y:v,type:"scatter",name:T}),f=u,w=[],v=[],y=new c(d(),p,g,I,2),E.forEach((t=>{w.push(t),a(y,t),v.push(f(y,t)),y.struct=[]})),T="Array-of-Arrays",x.push({x:w,y:v,type:"scatter",name:T}),Plotly.newPlot("g1",x,{title:L,height:600}),L="Remote Insertions",x=[],f=function(t,e){return o(t,h(e).reverse())},w=[],v=[],y=new n(d(),p,g,I,2),y.insertText=function(){},y.deleteText=function(){},E.forEach((t=>{w.push(t),v.push(f(y,t)),y.struct=[]})),T="Linear",x.push({x:w,y:v,type:"scatter",name:T}),f=l,w=[],v=[],y=new c(d(),p,g,I,2),E.forEach((t=>{w.push(t),v.push(f(y,t)),y.struct=[]})),T="Array-of-Arrays",x.push({x:w,y:v,type:"scatter",name:T}),Plotly.newPlot("g2",x,{title:L,height:600}),L="Remote Deletions",x=[],f=function(t){let e=[];return t.struct.forEach((t=>e.push(t))),function(t,e){const r=Date.now();return e.forEach((e=>t.handleRemoteDelete(e))),Date.now()-r}(t,e)},w=[],v=[],y=new n(d(),p,g,I,2),y.insertText=function(){},y.deleteText=function(){},E.forEach((t=>{w.push(t),function(t,e){o(t,h(e))}(y,t),v.push(f(y,t)),y.struct=[]})),T="Linear",x.push({x:w,y:v,type:"scatter",name:T}),f=u,w=[],v=[],y=new c(d(),p,g,I,2),E.forEach((t=>{w.push(t),a(y,t),v.push(f(y,t)),y.struct=[]})),T="Array-of-Arrays",x.push({x:w,y:v,type:"scatter",name:T}),Plotly.newPlot("g3",x,{title:L,height:600})})()})();